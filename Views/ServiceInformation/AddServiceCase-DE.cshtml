@model IEnumerable<css.Data.Models.tbl_ProblemDescriptionIssue>

@{
    ViewBag.Title = "Servicefall hinzufügen";
    Layout = "~/Views/Shared/_Layout-DE.cshtml";
}




<div class="row">
    <div id="tab1-alert" role="alert" class="alert alert-danger alert-icon alert-border-color alert-dismissible" style="display: none;">
        <div class="icon"><span class="s7-close-circle"></span></div>
        <div id="warningMSg1" class="message">
            <button type="button" data-dismiss="alert" aria-label="Close" class="close"><span aria-hidden="true" class="s7-close"></span></button> Hola
        </div>
    </div>

    <div id="success-alert1" role="alert" class="alert alert-success alert-icon alert-dismissible" style="display: none;">
        <div class="icon"><span class="s7-check"></span></div>
        <div id="SuccessMSg1" class="message">
            <button type="button" data-dismiss="alert" aria-label="Close" class="close"><span aria-hidden="true" class="s7-close"></span></button><strong>Great!</strong> Successful
        </div>
    </div>

    <div class="center">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3>
                    Allgemeine Informationen
                </h3>
            </div>
            <div class="panel-body">
                <form role="form" class="form-horizontal">

                    <div class="form-group">
                        <label for="Cname" class="col-sm-2 control-label">Kundin:</label>
                        <div class="col-sm-4">
                            <input id="Cname" type="text" placeholder="Kundin Name" class="form-control" required>
                        </div>
                        <label for="street" class="col-sm-2 control-label">Straße:</label>
                        <div class="col-sm-4">
                            <input id="street" type="text" placeholder="Straße" class="form-control" required>
                        </div>

                    </div>

                    <div class="form-group">
                        <label for="zipcode" class="col-sm-2 control-label">Postleitzahl und Ort:</label>
                        <div class="col-sm-4">
                            <input id="zipcode" type="text" placeholder="Postleitzahl und Ort" class="form-control" required>
                        </div>
                        <label for="country" class="col-sm-2 control-label">Land:</label>
                        <div class="col-sm-4">
                            <input id="country" type="text" placeholder="Land" class="form-control" required>
                        </div>
                    </div>
                </form>
            </div>

            <div class="panel-heading">
                <h3>Contact Person</h3>
            </div>
            <div class="panel-body">
                <input type="hidden" id="hdnContactId" />
                <form id="ContactForm" role="form" class="form-horizontal">
                    
                    <div class="form-group">
                        <label for="Contactname" class="col-sm-2 control-label">Name:</label>
                        <div class="col-sm-4">
                            <input name="Contactname" id="Contactname" type="text" placeholder="Name" class="form-control" /> @*data-val="true" data-val-required="*Contact Name is required">*@
                            <span style="color: red;" class="field-validation-valid" data-valmsg-for="Contactname" data-valmsg-replace="true"></span>
                        </div>
                        <label for="contactEmail" class="col-sm-2 control-label">Email:</label>
                        <div class="col-sm-4">
                            <input id="contactEmail" name="contactEmail" type="email" placeholder="Email" class="form-control" />  @*data-val="true" data-val-required="*Email is required" data-val-email="*Email Invalid">*@
                            <span style="color: red;" class="field-validation-valid" data-valmsg-for="contactEmail" data-valmsg-replace="true"></span>
                        </div>

                    </div>

                    <div class="form-group">
                        <label for="ContactPhone" class="col-sm-2 control-label">Telefon:</label>
                        <div class="col-sm-4">                           
                            <input id="ContactPhone" name="ContactPhone" placeholder="Telefon" class="form-control" type="tel" data-val-regex-pattern="^[0-9-+\s()]*$" data-val="true" data-val-regex="Please enter correct phone number" data-val-phone="*Enter Valid Phone Number"  />  @* data-val-required="*Phone Number is required">*@
                            <span style="color: red;" class="field-validation-valid" data-valmsg-for="ContactPhone" data-valmsg-replace="true"></span>

                        </div>
                    </div>
                </form>
            </div>


            <div class="panel-heading">
                <h3>Problembeschreibung</h3>
            </div>
            <div class="panel-body">
                <form role="form" id="Problemform" class="form-horizontal">
                    <div class="form-group">
                        <label for="Sreq" class="col-sm-2 control-label">Service-Anfrage:</label>
                        <div class="col-sm-4">


                            @Html.DropDownListFor(
                            x => x.FirstOrDefault().Issue_ID, 
                            new SelectList(Model, "Issue_ID", "Issue"),
                            new { @class = "form-control" })
                          

                        </div>

                        <label for="Reason" class="col-sm-2 control-label">Rücksendegrund:</label>
                        <div class="col-sm-4">
                            <input id="Reason" name="Reason" placeholder="Grund" type="text" class="form-control" />  @*data-val="true" data-val-required="*Reason is required">*@
                            <span style="color: red;" class="field-validation-valid" data-valmsg-for="Reason" data-valmsg-replace="true"></span>
                        </div>

                    </div>

                    <div class="form-group">
                        <label for="refno" class="col-sm-2 control-label">Referenznummer:</label>
                        <div class="col-sm-4">
                            <input id="refno" placeholder="Referenznummer" type="text" class="form-control">
                        </div>
                    </div>


                </form>
            </div>


            <div class="panel-heading">
                <h3>Further Information</h3>
            </div>
            <div class="panel-body">
                <form role="form" class="form-horizontal">
                    <div class="form-group">
                        <label for="furtherinfo" class="col-sm-2 control-label">                          
                            Weitere Informationen:
                        </label>
                        <div class="col-sm-4">
                            <input id="furtherinfo" placeholder="Weitere Informationen" type="text" class="form-control" required>
                        </div>

                        @*<label for="btnupload" class="col-sm-2 control-label">Upload Data:</label>
                        <div class="col-sm-4">
                            <button id="btnupload" type="button" class="btn btn-success md-close">Upload</button>
                        </div>*@

                    </div>



                    <div class="form-group pull-right">
                        <button id="btnSaveServiceCase" type="button" class="btn btn-success md-close">speichern</button>
                    </div>

                </form>
            </div>

        </div>
    </div>
</div>


@section PageLevelJs{

    <script src="../../assets/lib/datatables/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="../../assets/lib/datatables/js/dataTables.bootstrap.min.js" type="text/javascript"></script>
    <script src="../../assets/lib/datatables/plugins/buttons/js/dataTables.buttons.js" type="text/javascript"></script>
    <script src="../../assets/lib/datatables/plugins/buttons/js/buttons.html5.js" type="text/javascript"></script>
    <script src="../../assets/lib/datatables/plugins/buttons/js/buttons.flash.js" type="text/javascript"></script>
    <script src="../../assets/lib/datatables/plugins/buttons/js/buttons.print.js" type="text/javascript"></script>
    <script src="../../assets/lib/datatables/plugins/buttons/js/buttons.colVis.js" type="text/javascript"></script>
    <script src="../../assets/lib/datatables/plugins/buttons/js/buttons.bootstrap.js" type="text/javascript"></script>
    <script src="../../assets/js/app-tables-datatables.js" type="text/javascript"></script>
    <script src="../../assets/lib/prettify/prettify.js" type="text/javascript"></script>



    <script type="text/javascript">

       var WebServiceUrl = 'https://sequware.site/';
        //var WebServiceUrl = 'http://localhost:58989/';
        $(window).load(function () {          
            $('#Heading1').text("Formular für Serviceanfragen")
            $('#Heading2').text("Servicefall hinzufügen")
        });

        $('#btnSaveServiceCase').click(function () {

            debugger;
            var Phone = new RegExp('^[0-9-+\s()]*$');
            var x = $("#ContactPhone").val();

            if (!Phone.test(x)) {
                alert('Geben Sie die richtige Telefonnummer ein');
                return false;
            }


            //if ($('#ContactForm').valid() == false) {
               
            //    return false;
            //}

            if (confirm('Möchten Sie einen neuen Servicefall erstellen ?')) {
                // Save it!
                
           
            debugger;
           
            //if ($('#Problemform').valid() == false) {
            //    return false;
            //}


            var FormSheet = {
                "cname": $("#Cname").val(),
                "address": "",
                "Country": $("#country").val(),
                "street": $("#street").val(),
                "Zipcode": $("#zipcode").val(),
                "company": $("#Cname").val(),
                "CustomerRefNo": $("#refno").val(),

                "name": $("#Contactname").val(),
                "email": $("#contactEmail").val(),
                "phone": $("#ContactPhone").val(),

                "Issue": $("#Issue_ID").val(),
                "ref_num": $("#refno").val(),
                "FurtherInformatin": $("#furtherinfo").val(),
                "reason": $("#Reason").val(),
                "companyID": $("#hdncompanyID").val(),
                "CreatedBy": $("#hdnUserName").val()

            }



            var apiurl = "api/_FormSheetRequest/CreateFormSheetWeb";
            var calltype = "POST";

            $.ajax({
                type: calltype,
                url: WebServiceUrl + apiurl,
                data: JSON.stringify(FormSheet),
                contentType: "application/json;charset=utf-8",
                success: function (result, status, xhr) {
                    debugger
                    $('#tab1-alert').attr("style", "display:none");
                    $('#success-alert1').attr("style", "display:in-block");
                    var msg = "Neuer Servicefall Nr. " + result.Request_id + " Hinzugefügt";
                    $('#SuccessMSg1').text(msg);
                    clearPage();

                },
                error: function (xhr, status, error) {
                    debugger
                    if (error != "") {
                        $('#success-alert1').attr("style", "display:none");
                        $('#tab1-alert').attr("style", "display:in-block");
                        $('#warningMSg1').text(error);
                    }
                }

            });

            }
        });

           
        function clearPage()
            {
                $("#Cname").val("");
                $("#country").val("");
                $("#street").val("");
                $("#zipcode").val("");                
                $("#refno").val("");

                $("#Contactname").val("");
                $("#contactEmail").val("");
                $("#ContactPhone").val("");

                $("#Issue_ID").val("1");
                $("#refno").val("");
                $("#furtherinfo").val("");
                $("#Reason").val("");

            }


        
    </script>
}